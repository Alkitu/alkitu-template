# ALI-116: DB User Profile & Onboarding (User + ContactPerson)

## Metadata
- **Issue Key**: ALI-116
- **Type**: Tarea
- **Status**: Discovery
- **Priority**: Medium
- **Assignee**: Luis Eduardo Urdaneta Martucci
- **Created**: 2025-11-18T02:59:16.649+0100
- **Updated**: 2025-11-23T22:07:22.109+0100
- **Sprint**: Diseño Interfaz y Data Base (ID: 37)

## Description

Completar la definición de `User` para soportar perfiles completos y onboarding obligatorio.
Incluir campos de datos personales, Main Address y Contact Person, además de la lógica de `profileComplete`.

**Modelos / campos clave:**

* `User.firstname`, `User.lastname`
* `User.phone`
* `User.company`
* `User.address` (Main Address para CLIENT)
* `User.contactPerson` (tipo `ContactPerson`)
* `User.profileComplete` (regla de negocio: cuándo pasa a true)

### ¿Dónde se usa en el sitemap?

**Pantallas:**

* **Profile – "My Account Settings" [Client] (ALI-45)**

    * Muestra / edita en el formulario:

        * `firstname`, `lastname`
        * `phone`
        * `email` (lectura o editable según reglas)
        * `company`
        * `address` como **Main Address**
        * `contactPerson.name`, `contactPerson.lastname`, `contactPerson.phone`, `contactPerson.email`

    * Un guardado exitoso actualiza esos campos y `updatedAt`.

* **Profile – "My Account Settings" [Employee] (ALI-46)**

    * Usa principalmente:

        * `firstname`, `lastname`, `phone`, `email`, `company`.

    * `address` no es relevante en UI, aunque exista en BD.

* **Profile – "My Account Settings" [Admin] (ALI-47)**

    * Similar a Employee:

        * `firstname`, `lastname`, `phone`, `email`, `company`.


* **User Onboarding – "Complete Your Profile" [Client] (ALI-54)**

    * Pantalla que fuerza a completar los campos mínimos antes de usar `/app`:

        * Obligatorios recomendados: `firstname`, `lastname`, `phone`, `address` (Main Address), y según negocio, `contactPerson`.

    * Al completar y guardar:

        * Actualiza el usuario y cambia `profileComplete` a `true`.


* **Middleware de acceso** `/app`

    * Después de Login:

        * Si `profileComplete = false` → redirige siempre a Onboarding / Profile.
        * Si `true` → permite acceder a dashboards y demás pantallas.

## Schema Definition

```prisma
/// EPIC DB-2 – User Profile & Onboarding (User + ContactPerson)

type ContactPerson {
  name     String
  lastname String
  phone    String
  email    String
}

enum Role {
  CLIENT
  EMPLOYEE
  ADMIN
}

model User {
  id               String          @id @default(auto()) @map("_id") @db.ObjectId
  email            String          @unique
  password         String
  firstname        String
  lastname         String
  phone            String
  company          String
  address          String?         // Main Address (relevante para CLIENT)
  contactPerson    ContactPerson?
  role             Role            @default(CLIENT)
  profileComplete  Boolean         @default(false)
  locations        WorkLocation[]  @relation("UserLocations")
  requests         Request[]       @relation("UserRequests")
  assignedRequests Request[]       @relation("RequestAssignedEmployee")
  notifications    Notification[]  @relation("UserNotifications")
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
}
```

## Links
- [View in Jira](https://alkitu.atlassian.net/browse/ALI-116)
