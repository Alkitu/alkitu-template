# ALI-118: DB Services, Categories & Dynamic Templates (Category + Service)

## Metadata
- **Issue Key**: ALI-118
- **Type**: Tarea
- **Status**: Discovery
- **Priority**: Medium
- **Assignee**: Luis Eduardo Urdaneta Martucci
- **Created**: 2025-11-18T02:59:37.009+0100
- **Updated**: 2025-11-23T22:07:22.579+0100
- **Sprint**: Diseño Interfaz y Data Base (ID: 37)

## Description

Definir la estructura de servicios y categorías, incluyendo el campo dinámico `requestTemplate` que se utilizará para construir formularios personalizados por tipo de servicio.

**Modelos / campos clave:**

* `Category.name`
* `Service.name`
* `Service.categoryId`
* `Service.thumbnail?`
* `Service.requestTemplate Json`

### ¿Dónde se usa en el sitemap?

**Pantallas:**

* **New Request – Step 2: "Select Service" [Client] (ALI-37)**

    * Muestra servicios provenientes de `Service`:

        * `name` del servicio.
        * Agrupación / filtro por `Category.name`.
        * Opcionalmente `thumbnail`.


* **New Request – Step 3: "Service Details Form" [Client] (ALI-38)**

    * Usa `Service.requestTemplate`:

        * El front interpreta el JSON y construye el formulario (inputs, textareas, selects, uploads, etc.).


* **Request Detail – "Request Overview & Status" [Client] (ALI-41)**

    * Muestra:

        * `service.name`
        * `service.category.name`
        * Resumen de campos respondidos (se almacenan en `Request.templateResponses`, pero su estructura viene de `Service.requestTemplate`).


* **Request Detail – "Job Details & Completion" [Employee] (ALI-43)**

    * El empleado ve:

        * El nombre del servicio.
        * Las respuestas del cliente a ese formulario dinámico.


* **Request Detail – "Request Management & Assignment" [Admin] (ALI-44)**

    * Admin ve lo mismo y puede usarlo para decidir asignaciones o cambios.

* **Services Catalog – "Service Types & Templates Management" [Admin] (ALI-56)**

    * Pantalla de gestión del modelo:

        * Crear / editar / borrar `Service`.
        * Seleccionar una `Category`.
        * Editar el `requestTemplate Json` mediante un builder o editor.
        * Gestionar categorías (crear / renombrar / eliminar).

## Schema Definition

```prisma
/// EPIC DB-4 – Services & Categories with Dynamic Request Templates

model Category {
  id        String     @id @default(auto()) @map("_id") @db.ObjectId
  name      String     @unique
  services  Service[]  @relation("CategoryServices")
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
}

model Service {
  id              String    @id @default(auto()) @map("_id") @db.ObjectId
  name            String
  category        Category  @relation("CategoryServices", fields: [categoryId], references: [id])
  categoryId      String    @db.ObjectId
  thumbnail       String?
  requestTemplate Json      // Esquema dinámico: notes, photos, selects, uploads, etc.
  requests        Request[] @relation("ServiceRequests")
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}
```

## Links
- [View in Jira](https://alkitu.atlassian.net/browse/ALI-118)
