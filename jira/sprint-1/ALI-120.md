# ALI-120: DB Notifications System (Notification)

## Metadata
- **Issue Key**: ALI-120
- **Type**: Tarea
- **Status**: Discovery
- **Priority**: Medium
- **Assignee**: Luis Eduardo Urdaneta Martucci
- **Created**: 2025-11-18T02:59:53.984+0100
- **Updated**: 2025-11-23T22:07:23.049+0100
- **Sprint**: Diseño Interfaz y Data Base (ID: 37)

## Description

Implementar el modelo de notificaciones internas para registrar y mostrar eventos clave relacionados con solicitudes para cada rol (Cliente, Empleado, Admin).

**Modelos / campos clave:**

* `Notification.userId`
* `type` (`REQUEST_CREATED`, `REQUEST_STATUS_CHANGED`, `REQUEST_CANCELLATION_REQUESTED`)
* `message`
* `data Json` (e.g. `requestId`, estados)
* `read`
* `createdAt`

### ¿Dónde se usa en el sitemap?

**Pantallas:**

* **Notifications – "My Notifications Center" [Client] (ALI-33)**

    * Lista `Notification` filtradas por `userId` (cliente actual).
    * Muestra:

        * `message` como texto.
        * `createdAt` como fecha/hora de evento.
        * Estado leído/no leído (`read`).

    * Cada item puede tener link a:

        * `/app/requests/:requestId` usando el `data` Json.


* **Notifications – "My Notifications Center" [Employee] (ALI-34)**

    * Lo mismo, pero para el empleado:

        * Notificaciones típicas cuando:

            * Se le asigna una solicitud (`REQUEST_STATUS_CHANGED` hacia ONGOING o similar).



* **Notifications – "My Notifications Center" [Admin] (ALI-35)**

    * Lista notificaciones del admin:

        * Por ejemplo, cuando un cliente solicita cancelación (`REQUEST_CANCELLATION_REQUESTED`).


* **En todo el flujo de Requests (sin pantalla específica)**

    * Al crear un `Request`:

        * Se genera `Notification` de tipo `REQUEST_CREATED` para Cliente y Admin.

    * Al cambiar de estado:

        * `REQUEST_STATUS_CHANGED` para las partes interesadas.

    * Al `cancellationRequested`:

        * `REQUEST_CANCELLATION_REQUESTED` para Admin (y si quieres también para Employee).

## Schema Definition

```prisma
/// EPIC DB-6 – In-App Notifications System (Notification)

enum NotificationType {
  REQUEST_CREATED
  REQUEST_STATUS_CHANGED
  REQUEST_CANCELLATION_REQUESTED
}

model Notification {
  id        String           @id @default(auto()) @map("_id") @db.ObjectId
  user      User             @relation("UserNotifications", fields: [userId], references: [id])
  userId    String           @db.ObjectId
  type      NotificationType
  message   String
  data      Json             // payload adicional: requestId, nuevo estado, etc.
  read      Boolean          @default(false)
  createdAt DateTime         @default(now())
}
```

## Links
- [View in Jira](https://alkitu.atlassian.net/browse/ALI-120)
