# ALI-122: DB Users & Roles Management (Admin View)

## Metadata
- **Issue Key**: ALI-122
- **Type**: Tarea
- **Status**: Discovery
- **Priority**: Medium
- **Assignee**: Luis Eduardo Urdaneta Martucci
- **Created**: 2025-11-18T03:00:12.539+0100
- **Updated**: 2025-11-23T22:07:23.462+0100
- **Sprint**: Diseño Interfaz y Data Base (ID: 37)

## Description

Aprovechar el modelo `User` para ofrecer al Admin una vista de gestión de equipo (Admins/Employees) y consulta de clientes, controlando roles y permisos desde BD.

**Modelos / campos clave:**

* `User.role` (CLIENT, EMPLOYEE, ADMIN)
* Datos básicos: `firstname`, `lastname`, `email`, `phone`, `company`

### ¿Dónde se usa en el sitemap?

**Pantallas:**

* **Users – "Team & Clients Management" [Admin] (ALI-58)**

    * Pestaña **Team**:

        * Lista usuarios donde `role IN (ADMIN, EMPLOYEE)`.
        * Muestra por cada uno: `firstname`, `lastname`, `email`, `phone`, `role`, `company`.
        * Formulario de alta:

            * Crea nuevo `User` con `role = EMPLOYEE` o `ADMIN`.

        * Edición:

            * Modificar datos básicos y rol.

        * Eliminación / desactivación:

            * Según política de negocio (soft delete o flags).


    * Pestaña **Clients**:

        * Lista usuarios con `role = CLIENT`.
        * Solo lectura:

            * Muestra datos básicos (`firstname`, `lastname`, `email`, `phone`, `company`, `address`).
            * Sin acciones de editar/eliminar desde esta pantalla (solo consulta).



* **Admin Dashboard – "Operations & Metrics Overview" [Admin] (ALI-28)**

    * Puede usar información de `User` para:

        * KPIs como nº de clientes activos, nº de empleados, etc.
        * Gráficos basados en `role`.

## Schema Definition

```prisma
/// EPIC DB-8 – Users & Roles Management (Admin View)

enum Role {
  CLIENT
  EMPLOYEE
  ADMIN
}

model User {
  id               String          @id @default(auto()) @map("_id") @db.ObjectId
  email            String          @unique
  password         String
  firstname        String
  lastname         String
  phone            String
  company          String
  address          String?         // Main Address (relevante para CLIENT)
  contactPerson    ContactPerson?
  role             Role            @default(CLIENT)
  profileComplete  Boolean         @default(false)
  locations        WorkLocation[]  @relation("UserLocations")
  requests         Request[]       @relation("UserRequests")
  assignedRequests Request[]       @relation("RequestAssignedEmployee")
  notifications    Notification[]  @relation("UserNotifications")
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
}

type ContactPerson {
  name     String
  lastname String
  phone    String
  email    String
}
```

## Links
- [View in Jira](https://alkitu.atlassian.net/browse/ALI-122)
